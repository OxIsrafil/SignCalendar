<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel ‚Äì Sign Scheduler</title>
  <link rel="stylesheet" href="../styles.css" />
</head>
<body>
  <nav class="navbar">
    <div class="logo">üîê Admin Panel</div>
  </nav>

  <section class="info-section">
    <div id="login-area">
      <h2>Admin Access</h2>
      <input type="password" id="adminPassword" placeholder="Enter admin password" class="input" />
      <button id="loginBtn" class="btn">Unlock Panel</button>
      <p id="loginMsg" style="color:red;"></p>
    </div>

    <div id="adminUI" style="display: none;">
      <h2>All Events (Moderation)</h2>
      <div id="eventsContainer"></div>
    </div>
  </section>

  <script>
    const ADMIN_PASSWORD = "signsuperadmin"; // you can change this
    const loginBtn = document.getElementById("loginBtn");
    const loginMsg = document.getElementById("loginMsg");

    loginBtn.addEventListener("click", () => {
      const entered = document.getElementById("adminPassword").value;
      if (entered === ADMIN_PASSWORD) {
        document.getElementById("login-area").style.display = "none";
        document.getElementById("adminUI").style.display = "block";
        loadEvents();
      } else {
        loginMsg.textContent = "Incorrect password!";
      }
    });

    async function loadEvents() {
      const res = await fetch("https://signcalendarbackend.onrender.com/api/events/all");
      const events = await res.json();

      const container = document.getElementById("eventsContainer");
      container.innerHTML = events.length
        ? events.map(ev => `
          <div class="event-card">
            <h3>${ev.title}</h3>
            <p>${ev.description}</p>
            <p><strong>Date:</strong> ${ev.date} | <strong>Time:</strong> ${ev.time}</p>
            <p><strong>Location:</strong> ${ev.location || "N/A"}</p>
            <p>Status: ${ev.approved ? "‚úÖ Approved" : "‚è≥ Pending"}</p>
            ${!ev.approved ? `
              <button onclick="approveEvent('${ev._id}')" class="btn">‚úÖ Approve</button>
              <button onclick="deleteEvent('${ev._id}')" class="btn" style="background:red;">‚ùå Reject</button>
            ` : ""}
          </div>
        `).join('')
        : "<p>No events yet.</p>";
    }

    async function approveEvent(id) {
      await fetch(`https://signcalendarbackend.onrender.com/api/events/${id}/approve`, { method: "PATCH" });
      loadEvents();
    }

    async function deleteEvent(id) {
      if (!confirm("Are you sure you want to reject and delete this event?")) return;
      await fetch(`https://signcalendarbackend.onrender.com/api/events/${id}`, { method: "DELETE" });
      loadEvents();
    }
  </script>
</body>
</html>
